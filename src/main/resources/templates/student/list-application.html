<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  th:fragment="page"
  th:data-theme="${user.theme.name.toLowerCase}"
>
<head th:replace="~{components :: head('My Applications')}"></head>
<body class="min-h-screen flex flex-col">
<div
  th:replace="~{components :: student-navbar(${user.displayName()})}"
></div>
<div class="bg-base-100 flex flex-col items-center min-h-screen m-10 gap-4">
  <div class="card card-normal w-full bg-base-200">
    <div class="card-body gap-10">
      <h1 class="card-title">My Applications</h1>
      <div th:fragment="programTable" id="programTable" class="contents">
        <div class="overflow-x-auto">
          <table class="table table-lg w-full">
            <thead>
              <tr>
                <th
                  th:replace="~{this :: sortableHeader('Title', '/applications/sort', 'TITLE', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('Year & Semester', '/applications/sort', 'YEAR_SEMESTER', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('Faculty Lead(s)', '/applications/sort', 'FACULTY', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('Start Date', '/applications/sort', 'START_DATE', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('End Date', '/applications/sort', 'END_DATE', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('Application Open', '/applications/sort', 'APPLICATION_OPEN', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('Application Closed', '/applications/sort', 'APPLICATION_CLOSED', '#programTable')}"
                ></th>
                <th
                  th:replace="~{this :: sortableHeader('Status', '/applications/sort', 'STATUS', '#programTable')}"
                ></th>
              </tr>
            </thead>
            <tbody>
              <tr
                th:each="pair : ${pairs}"
                class="border-base-300 border-y-2"
              >
                <td>
                  <a
                    th:href="@{'/applications/' + ${pair.app().id()}}"
                    class="link link-primary"
                  >
                    <span th:text="${pair.prog().title()}"
                      >Program Title</span
                    >
                  </a>
                </td>
                <td
                  th:text="${formatter.formatTerm(pair.prog().semester(), pair.prog().year())}"
                ></td>
                <td>TODO</td>
                <td
                  th:text="${formatter.formatLocalDate(pair.prog().startDate())}"
                ></td>
                <td
                  th:text="${formatter.formatLocalDate(pair.prog().endDate())}"
                ></td>
                <td
                  th:text="${formatter.formatLocalDate(pair.prog().applicationOpen())}"
                ></td>
                <td
                  th:text="${formatter.formatLocalDate(pair.prog().applicationClose())}"
                ></td>
                <td>
                  <div
                    th:replace="~{components :: statusBadge(${pair.app().status().name()})}"
                  ></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<div th:replace="~{components :: footer}"></div>
</body>
</html>


<div xmlns:th="http://www.thymeleaf.org" th:fragment="sortableHeader(label, path, column, target)">
  <th th:class="${sort.name == column} ? 'bg-base-300 cursor-pointer' : 'cursor-pointer'"
      th:hx-get="@{${path}(sort=${column}, ascending=!${ascending})}"
      th:hx-target="${target}"
      hx-swap="outerHTML">
    <div class="flex items-center gap-2">
      <span th:if="${sort.name == column}" th:text="${ascending} ? '▲' : '▼'"></span>
      <div th:unless="${sort.name == column}" class="invisible">▼</div>
      <span th:text="${label}"></span>
    </div>
  </th>
</div>
