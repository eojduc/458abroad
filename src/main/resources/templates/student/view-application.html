<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  th:fragment="page"
  th:data-theme="${theme}"
>
  <head th:replace="~{components :: head('Application Details')}"></head>
  <body class="flex flex-col min-h-screen">
    <div
      th:replace="~{components :: student-navbar(${user.displayName()})}"
    ></div>
    <div
      id="applicationContent"
      class="container mx-auto p-4 flex-grow"
      th:fragment="applicationContent"
    >
      <!-- Program Information Card -->
      <div class="card bg-base-200 shadow-lg p-6 mb-6">
        <h1 class="card-title mb-4" th:text="${prog.title()}">Program Title</h1>
        <div class="card-body">
          <p>
            <strong>Term:</strong>
            <span
              th:text="${formatter.formatTerm(prog.semester(), prog.year())}"
              >Term Info</span
            >
          </p>
          <p>
            <strong>Faculty Lead(s):</strong>
            <span th:text="${prog.facultyLead()}">Faculty Lead</span>
          </p>
          <p>
            <strong>Dates:</strong>
            <span
              th:text="'Start: ' + ${formatter.formatLocalDate(prog.startDate())}"
              >Start Date</span
            >,
            <span
              th:text="'End: ' + ${formatter.formatLocalDate(prog.endDate())}"
              >End Date</span
            >
          </p>
          <p>
            <strong>Application Window:</strong>
            <span
              th:text="'Open: ' + ${formatter.formatInstant(prog.applicationOpen())}"
              >Open</span
            >
            -
            <span
              th:text="'Close: ' + ${formatter.formatInstant(prog.applicationClose())}"
              >Close</span
            >
          </p>
          <p>
            <strong>Description:</strong>
            <span th:text="${prog.description()}">Program Description</span>
          </p>
        </div>
      </div>

      <!-- Application Details Card -->
      <div
        id="applicationResponses"
        th:fragment="applicationResponses"
        class="card bg-base-200 shadow-lg p-6"
      >
        <div class="card-body">
          <h2 class="card-title mb-4">My Application</h2>
          <p>
            <strong>Application ID:</strong>
            <span th:text="${app.id}">APP_ID</span>
          </p>
          <p>
            <strong>Status:</strong>
            <span
              class="badge badge-lg"
              th:classappend="${(app.status.name() == 'APPLIED') ? ' badge-info' : (app.status.name() == 'ENROLLED' ? ' badge-success' : ' badge-warning')}"
              th:text="${app.status.name()}"
              >STATUS</span
            >
          </p>

          <!-- Application Responses -->
          <div class="mt-6">
            <h3 class="text-xl font-semibold mb-2">Your Responses</h3>
            <form
              id="responsesForm"
              th:attr="hx-post=@{'/applications/' + ${app.id()} + '/update'}"
              hx-target="#applicationContent"
              hx-swap="outerHTML"
            >
              <div id="responsesContainer">
                <div class="form-control mb-4">
                  <label class="label">
                    <span class="label-text">Answer 1</span>
                  </label>
                  <textarea
                    class="textarea textarea-bordered"
                    name="answer1"
                    th:text="${app.answer1()}"
                    th:disabled="${!editable}"
                  ></textarea>
                </div>
                <div class="form-control mb-4">
                  <label class="label">
                    <span class="label-text">Answer 2</span>
                  </label>
                  <textarea
                    class="textarea textarea-bordered"
                    name="answer2"
                    th:text="${app.answer2()}"
                    th:disabled="${!editable}"
                  ></textarea>
                </div>
                <div class="form-control mb-4">
                  <label class="label">
                    <span class="label-text">Answer 2</span>
                  </label>
                  <textarea
                    class="textarea textarea-bordered"
                    name="answer3"
                    th:text="${app.answer3()}"
                    th:disabled="${!editable}"
                  ></textarea>
                </div>
                <div class="form-control mb-4">
                  <label class="label">
                    <span class="label-text">Answer 2</span>
                  </label>
                  <textarea
                    class="textarea textarea-bordered"
                    name="answer4"
                    th:text="${app.answer4()}"
                    th:disabled="${!editable}"
                  ></textarea>
                </div>
                <div class="form-control mb-4">
                  <label class="label">
                    <span class="label-text">Answer 2</span>
                  </label>
                  <textarea
                    class="textarea textarea-bordered"
                    name="answer5"
                    th:text="${app.answer5()}"
                    th:disabled="${!editable}"
                  ></textarea>
                </div>
              </div>
              <div class="form-control mt-4" th:if="${editable}">
                <button type="submit" class="btn btn-primary">
                  Save Responses
                </button>
              </div>
            </form>
          </div>

          <!-- Withdraw / Reactivate Actions -->
          <div class="mt-6">
            <h3 class="text-xl font-semibold mb-2">Application Actions</h3>
            <div th:switch="${app.status.name()}">
              <div th:case="'WITHDRAWN'">
                <button
                  class="btn btn-success"
                  th:attr="hx-post=@{'/applications/' + ${app.id()} + '/reactivate'}"
                  hx-confirm="Are you sure you want to reactivate your application? This will set your status to 'APPLIED'."
                  hx-target="#applicationContent"
                  hx-swap="outerHTML"
                >
                  Reactivate Application
                </button>
              </div>
              <!-- If the status is not canceled or withdrawn, allow withdrawal -->
              <div th:case="*">
                <div
                  th:if="${app.status.name() != 'CANCELLED' and app.status.name() != 'WITHDRAWN'}"
                >
                  <button
                    class="btn btn-warning"
                    th:attr="hx-post=@{'/applications/' + ${app.id()} + '/withdraw'}"
                    hx-confirm="Are you sure you want to withdraw your application? This action cannot be undone."
                    hx-target="#applicationContent"
                    hx-swap="outerHTML"
                  >
                    Withdraw Application
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div th:replace="~{components :: footer}"></div>
  </body>
</html>
